apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-test
  labels:
     grafana_dashboard: "1"
data:
  sciety-test-dashboard.json: |-
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "datasource",
              "uid": "grafana"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          },
          {
            "datasource": {},
            "enable": true,
            "expr": "sum(changes(nginx_ingress_controller_config_last_reload_successful_timestamp_seconds{instance!=\"unknown\",controller_class=~\"$controller_class\",namespace=~\"$namespace\"}[30s])) by (controller_class)",
            "hide": false,
            "iconColor": "rgba(255, 96, 96, 1)",
            "limit": 100,
            "name": "Config Reloads",
            "showIn": 0,
            "step": "30s",
            "tagKeys": "controller_class",
            "tags": [],
            "titleFormat": "Config Reloaded",
            "type": "tags"
          }
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "panels": [
      {
    "datasource": {
    "type": "prometheus",
    "uid": "${DS_PROMETHEUS}"
    },
    "description": "",
    "fieldConfig": {
    "defaults": {
    "mappings": [],
    "thresholds": {
    "mode": "absolute",
    "steps": [
    {
      "color": "blue",
      "value": null
    },
    {
      "color": "red",
      "value": 100
    }
    ]
    },
    "decimals": 0,
    "noValue": "0",
    "unit": "short"
    },
    "overrides": []
    },
    "gridPos": {
    "h": 5,
    "w": 6,
    "x": 0,
    "y": 0
    },
    "id": 24,
    "options": {
    "reduceOptions": {
    "values": false,
    "calcs": [
    "last"
    ],
    "fields": ""
    },
    "orientation": "auto",
    "textMode": "value",
    "wideLayout": true,
    "colorMode": "value",
    "graphMode": "none",
    "justifyMode": "auto",
    "showPercentChange": false,
    "text": {}
    },
    "pluginVersion": "10.4.0",
    "targets": [
    {
    "datasource": {
    "type": "prometheus",
    "uid": "prometheus"
    },
    "editorMode": "code",
    "exemplar": false,
    "expr": "count(gotk_resource_info{exported_namespace=~\"$namespace\", customresource_kind=~\"Kustomization|HelmRelease\"})",
    "instant": true,
    "interval": "",
    "legendFormat": "",
    "range": false,
    "refId": "A"
    }
    ],
    "title": "Cluster Reconcilers",
    "type": "stat"
      }
      ],
      "refresh": "5s",
      "schemaVersion": 39,
      "tags": [
        "sciety",
        "nginx"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "selected": false,
              "text": "VictoriaMetrics",
              "value": "P4169E866C3094E38"
            },
            "hide": 0,
            "includeAll": false,
            "label": "datasource",
            "multi": false,
            "name": "DS_PROMETHEUS",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "type": "datasource"
          },
          {
            "allValue": ".*",
            "current": {
              "selected": false,
              "text": "All",
              "value": "$__all"
            },
            "datasource": {
              "uid": ""
            },
            "definition": "",
            "hide": 0,
            "includeAll": true,
            "label": "Namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(nginx_ingress_controller_config_hash, controller_namespace)",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 0,
            "tagValuesQuery": "",
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": ".*",
            "current": {
              "selected": false,
              "text": "All",
              "value": "$__all"
            },
            "datasource": {
              "uid": ""
            },
            "definition": "",
            "hide": 0,
            "includeAll": true,
            "label": "Controller Class",
            "multi": false,
            "name": "controller_class",
            "options": [],
            "query": "label_values(nginx_ingress_controller_config_hash{namespace=~\"$namespace\"}, controller_class) ",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 0,
            "tagValuesQuery": "",
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": ".*",
            "current": {
              "selected": false,
              "text": "All",
              "value": "$__all"
            },
            "datasource": {
              "uid": ""
            },
            "definition": "",
            "hide": 0,
            "includeAll": true,
            "label": "Controller",
            "multi": false,
            "name": "controller",
            "options": [],
            "query": "label_values(nginx_ingress_controller_config_hash{namespace=~\"$namespace\",controller_class=~\"$controller_class\"}, controller_pod) ",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 0,
            "tagValuesQuery": "",
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": ".*",
            "current": {
              "selected": false,
              "text": "All",
              "value": "$__all"
            },
            "datasource": {
              "uid": ""
            },
            "definition": "",
            "hide": 0,
            "includeAll": true,
            "label": "Ingress",
            "multi": false,
            "name": "ingress",
            "options": [],
            "query": "label_values(nginx_ingress_controller_requests{namespace=~\"$namespace\",controller_class=~\"$controller_class\",controller=~\"$controller\"}, ingress) ",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 2,
            "tagValuesQuery": "",
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "2m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "browser",
      "title": "Sciety test dashboard",
      "uid": "nginx",
      "version": 5,
      "weekStart": ""
    }